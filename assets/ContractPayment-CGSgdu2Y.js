import{_ as ve,a as _,r as S,c as q,o as N,d as e,w as t,e as d,F as K,i as Q,g as c,t as P,b as D,D as A,m as be,I as W,H as X,O as Z,j as E,h as ee,E as h,J as _e}from"./index-BrrAfP23.js";const ge={class:"contract-payment-container"},De={class:"card-header"},Ve={class:"payment-plans-container"},Pe={key:0,class:"add-plan-button"},Ae={class:"dialog-footer"},Ne={class:"dialog-footer"},ke={__name:"ContractPayment",setup(we){const g=_([{id:1,contractNo:"HT-2023-001",counterparty:"北京科技有限公司",startDate:"2023-01-01",endDate:"2023-12-31",totalAmount:1e5,paidAmount:3e4,status:"active",visibility:["sales","finance"],paymentPlans:[{id:1,phase:"首付款",amount:3e4,planDate:"2023-01-15",condition:"合同签订后",status:"paid",paidDate:"2023-01-16"},{id:2,phase:"进度款",amount:4e4,planDate:"2023-06-15",condition:"项目中期验收后",status:"unpaid",paidDate:null},{id:3,phase:"尾款",amount:3e4,planDate:"2023-12-15",condition:"项目终验后",status:"unpaid",paidDate:null}]},{id:2,contractNo:"HT-2023-002",counterparty:"上海贸易有限公司",startDate:"2023-03-01",endDate:"2024-02-29",totalAmount:2e5,paidAmount:1e5,status:"active",visibility:["marketing","finance","admin"],paymentPlans:[{id:4,phase:"首付款",amount:1e5,planDate:"2023-03-10",condition:"合同签订后",status:"paid",paidDate:"2023-03-12"},{id:5,phase:"尾款",amount:1e5,planDate:"2023-09-10",condition:"货物交付后",status:"unpaid",paidDate:null}]}]),f=S({contractNo:"",counterparty:"",status:"all"}),te=[{value:"all",label:"全部"},{value:"active",label:"有效"},{value:"expired",label:"已过期"},{value:"completed",label:"已完成"}],ae=[{value:"sales",label:"销售部"},{value:"marketing",label:"市场部"},{value:"rd",label:"研发部"},{value:"finance",label:"财务部"},{value:"hr",label:"人力资源部"},{value:"admin",label:"行政部"}],V=_(!1),y=_(""),x=_(""),R=_(null),o=S({id:null,contractNo:"",counterparty:"",startDate:"",endDate:"",totalAmount:"",status:"active",visibility:[],attachments:[],paymentPlans:[]}),le={contractNo:[{required:!0,message:"请输入合同编号",trigger:"blur"}],counterparty:[{required:!0,message:"请输入签约方",trigger:"blur"}],startDate:[{required:!0,message:"请选择开始日期",trigger:"change"}],endDate:[{required:!0,message:"请选择结束日期",trigger:"change"}],totalAmount:[{required:!0,message:"请输入合同总金额",trigger:"blur"},{type:"number",message:"金额必须为数字",trigger:"blur",transform:n=>Number(n)}],visibility:[{required:!0,message:"请选择可见范围",trigger:"change"}],paymentPlans:[{required:!0,message:"请至少添加一个付款计划",trigger:"change"}]},T=_(null),r=S({phase:"",amount:"",planDate:"",condition:""}),ne={phase:[{required:!0,message:"请输入付款阶段名称",trigger:"blur"}],amount:[{required:!0,message:"请输入付款金额",trigger:"blur"},{type:"number",message:"金额必须为数字",trigger:"blur",transform:n=>Number(n)}],planDate:[{required:!0,message:"请选择计划付款日期",trigger:"change"}],condition:[{required:!0,message:"请输入付款条件",trigger:"blur"}]},$=_(null),k=_(!1),F=_(!1),O=_(-1),B=n=>new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(n),oe=n=>{switch(n){case"active":return"success";case"expired":return"danger";case"completed":return"info";default:return"warning"}},ue=n=>n?n.paidAmount===0?"未付款":n.paidAmount===n.totalAmount?"已付清":"部分付款":"",se=()=>{console.log("搜索条件:",f),h.success("搜索完成")},de=()=>{f.contractNo="",f.counterparty="",f.status="all"},ie=()=>{y.value="add",x.value="新增合同",V.value=!0,Object.assign(o,{id:null,contractNo:"",counterparty:"",startDate:"",endDate:"",totalAmount:"",status:"active",visibility:[],attachments:[],paymentPlans:[]})},re=n=>{y.value="edit",x.value="编辑合同",V.value=!0,R.value=n,Object.assign(o,{id:n.id,contractNo:n.contractNo,counterparty:n.counterparty,startDate:n.startDate,endDate:n.endDate,totalAmount:n.totalAmount,status:n.status,visibility:[...n.visibility],attachments:[],paymentPlans:[...n.paymentPlans]})},pe=n=>{y.value="view",x.value="合同详情",V.value=!0,R.value=n,Object.assign(o,{id:n.id,contractNo:n.contractNo,counterparty:n.counterparty,startDate:n.startDate,endDate:n.endDate,totalAmount:n.totalAmount,status:n.status,visibility:[...n.visibility],attachments:[],paymentPlans:[...n.paymentPlans]})},me=n=>{_e.confirm(`确定要删除合同 ${n.contractNo} 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const a=g.value.findIndex(i=>i.id===n.id);a!==-1&&g.value.splice(a,1),h.success("删除成功")}).catch(()=>{})},ce=async()=>{T.value&&await T.value.validate((n,a)=>{if(n){const i=o.paymentPlans.reduce((v,p)=>v+Number(p.amount),0);if(i!==Number(o.totalAmount)){h.error(`付款计划总金额(${i})与合同总金额(${o.totalAmount})不一致`);return}const s=h({message:y.value==="add"?"正在创建合同...":"正在更新合同...",type:"info",duration:0});setTimeout(()=>{if(s.close(),y.value==="add"){const v={id:g.value.length+1,contractNo:o.contractNo,counterparty:o.counterparty,startDate:o.startDate,endDate:o.endDate,totalAmount:Number(o.totalAmount),paidAmount:0,status:o.status,visibility:[...o.visibility],paymentPlans:o.paymentPlans.map((p,w)=>({id:new Date().getTime()+w,phase:p.phase,amount:Number(p.amount),planDate:p.planDate,condition:p.condition,status:"unpaid",paidDate:null}))};g.value.push(v)}else if(y.value==="edit"){const v=g.value.findIndex(p=>p.id===o.id);if(v!==-1){const p=g.value[v].paidAmount,w=o.paymentPlans.map(b=>{const u=g.value[v].paymentPlans.find(C=>C.id===b.id);return{...b,status:(u==null?void 0:u.status)||"unpaid",paidDate:(u==null?void 0:u.paidDate)||null}});g.value[v]={...o,id:o.id,totalAmount:Number(o.totalAmount),paidAmount:p,paymentPlans:w}}}V.value=!1,h.success(y.value==="add"?"合同创建成功":"合同更新成功")},1e3)}})},H=(n=!1,a=-1)=>{if(F.value=n,O.value=a,k.value=!0,n){const i=o.paymentPlans[a];Object.assign(r,{phase:i.phase,amount:i.amount,planDate:i.planDate})}else Object.assign(r,{phase:"",amount:"",planDate:"",condition:""})},fe=async()=>{$.value&&await $.value.validate((n,a)=>{n&&(F.value?o.paymentPlans[O.value]={...o.paymentPlans[O.value],...r}:o.paymentPlans.push({...r}),k.value=!1)})},ye=n=>{o.paymentPlans.splice(n,1)};return(n,a)=>{const i=d("el-input"),s=d("el-form-item"),v=d("el-option"),p=d("el-select"),w=d("Search"),b=d("el-icon"),u=d("el-button"),C=d("el-form"),L=d("el-card"),m=d("el-table-column"),M=d("el-tag"),z=d("el-button-group"),J=d("el-table"),j=d("el-date-picker"),I=d("el-col"),Y=d("el-input-number"),G=d("el-dialog");return N(),q("div",ge,[e(L,{class:"search-card"},{default:t(()=>[e(C,{model:f,inline:""},{default:t(()=>[e(s,{label:"合同编号"},{default:t(()=>[e(i,{modelValue:f.contractNo,"onUpdate:modelValue":a[0]||(a[0]=l=>f.contractNo=l),placeholder:"请输入合同编号",clearable:""},null,8,["modelValue"])]),_:1}),e(s,{label:"签约方"},{default:t(()=>[e(i,{modelValue:f.counterparty,"onUpdate:modelValue":a[1]||(a[1]=l=>f.counterparty=l),placeholder:"请输入签约方",clearable:""},null,8,["modelValue"])]),_:1}),e(s,{label:"状态"},{default:t(()=>[e(p,{modelValue:f.status,"onUpdate:modelValue":a[2]||(a[2]=l=>f.status=l),placeholder:"请选择状态"},{default:t(()=>[(N(),q(K,null,Q(te,l=>e(v,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:t(()=>[e(u,{type:"primary",onClick:se},{default:t(()=>[e(b,null,{default:t(()=>[e(w)]),_:1}),a[18]||(a[18]=c("搜索 "))]),_:1}),e(u,{onClick:de},{default:t(()=>a[19]||(a[19]=[c("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(L,{class:"contract-list-card"},{header:t(()=>[D("div",De,[a[21]||(a[21]=D("span",null,"合同列表",-1)),e(u,{type:"primary",onClick:ie},{default:t(()=>[e(b,null,{default:t(()=>[e(A(Z))]),_:1}),a[20]||(a[20]=c("新增合同 "))]),_:1})])]),default:t(()=>[e(J,{data:g.value,style:{width:"100%"}},{default:t(()=>[e(m,{prop:"contractNo",label:"合同编号",width:"120"}),e(m,{prop:"counterparty",label:"签约方",width:"180"}),e(m,{label:"合同期限",width:"240"},{default:t(({row:l})=>[c(P(l.startDate)+" 至 "+P(l.endDate),1)]),_:1}),e(m,{label:"金额信息",width:"200"},{default:t(({row:l})=>[D("div",null,"总金额："+P(B(l.totalAmount)),1),D("div",null,"已付金额："+P(B(l.paidAmount)),1)]),_:1}),e(m,{label:"状态",width:"100"},{default:t(({row:l})=>[e(M,{type:oe(l.status)},{default:t(()=>[c(P(l.status==="active"?"有效":l.status==="expired"?"已过期":"已完成"),1)]),_:2},1032,["type"])]),_:1}),e(m,{label:"付款状态",width:"100"},{default:t(({row:l})=>[e(M,{type:l.paidAmount===l.totalAmount?"success":l.paidAmount===0?"info":"warning"},{default:t(()=>[c(P(ue(l)),1)]),_:2},1032,["type"])]),_:1}),e(m,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[e(z,null,{default:t(()=>[e(u,{type:"primary",onClick:U=>pe(l),title:"查看"},{default:t(()=>[e(b,null,{default:t(()=>[e(A(be))]),_:1})]),_:2},1032,["onClick"]),e(u,{type:"warning",onClick:U=>re(l),title:"编辑"},{default:t(()=>[e(b,null,{default:t(()=>[e(A(W))]),_:1})]),_:2},1032,["onClick"]),e(u,{type:"danger",onClick:U=>me(l),title:"删除"},{default:t(()=>[e(b,null,{default:t(()=>[e(A(X))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1}),e(G,{modelValue:V.value,"onUpdate:modelValue":a[11]||(a[11]=l=>V.value=l),title:x.value,width:"60%","close-on-click-modal":!1},{footer:t(()=>[D("span",Ae,[e(u,{onClick:a[10]||(a[10]=l=>V.value=!1)},{default:t(()=>a[24]||(a[24]=[c("取消")])),_:1}),y.value!=="view"?(N(),ee(u,{key:0,type:"primary",onClick:ce},{default:t(()=>a[25]||(a[25]=[c(" 确定 ")])),_:1})):E("",!0)])]),default:t(()=>[e(C,{ref_key:"formRef",ref:T,model:o,rules:le,"label-width":"100px",disabled:y.value==="view"},{default:t(()=>[e(s,{label:"合同编号",prop:"contractNo"},{default:t(()=>[e(i,{modelValue:o.contractNo,"onUpdate:modelValue":a[3]||(a[3]=l=>o.contractNo=l),placeholder:"请输入合同编号"},null,8,["modelValue"])]),_:1}),e(s,{label:"签约方",prop:"counterparty"},{default:t(()=>[e(i,{modelValue:o.counterparty,"onUpdate:modelValue":a[4]||(a[4]=l=>o.counterparty=l),placeholder:"请输入签约方"},null,8,["modelValue"])]),_:1}),e(s,{label:"合同期限"},{default:t(()=>[e(I,{span:11},{default:t(()=>[e(s,{prop:"startDate"},{default:t(()=>[e(j,{modelValue:o.startDate,"onUpdate:modelValue":a[5]||(a[5]=l=>o.startDate=l),type:"date",placeholder:"开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(I,{span:2,class:"text-center"},{default:t(()=>a[22]||(a[22]=[D("span",null,"-",-1)])),_:1}),e(I,{span:11},{default:t(()=>[e(s,{prop:"endDate"},{default:t(()=>[e(j,{modelValue:o.endDate,"onUpdate:modelValue":a[6]||(a[6]=l=>o.endDate=l),type:"date",placeholder:"结束日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(s,{label:"合同金额",prop:"totalAmount"},{default:t(()=>[e(Y,{modelValue:o.totalAmount,"onUpdate:modelValue":a[7]||(a[7]=l=>o.totalAmount=l),min:0,precision:2,step:1e3,style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(s,{label:"可见范围",prop:"visibility"},{default:t(()=>[e(p,{modelValue:o.visibility,"onUpdate:modelValue":a[8]||(a[8]=l=>o.visibility=l),multiple:"",placeholder:"请选择可见范围",style:{width:"100%"}},{default:t(()=>[(N(),q(K,null,Q(ae,l=>e(v,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"付款计划",prop:"paymentPlans"},{default:t(()=>[D("div",Ve,[e(J,{data:o.paymentPlans,style:{width:"100%"}},{default:t(()=>[e(m,{prop:"phase",label:"付款阶段",width:"150"}),e(m,{prop:"amount",label:"付款金额",width:"150"},{default:t(({row:l})=>[c(P(B(l.amount)),1)]),_:1}),e(m,{prop:"planDate",label:"计划付款日期",width:"150"}),e(m,{prop:"condition",label:"付款条件"}),y.value!=="view"?(N(),ee(m,{key:0,label:"操作",width:"150"},{default:t(({$index:l})=>[e(z,null,{default:t(()=>[e(u,{type:"primary",onClick:U=>H(!0,l),title:"编辑"},{default:t(()=>[e(b,null,{default:t(()=>[e(A(W))]),_:1})]),_:2},1032,["onClick"]),e(u,{type:"danger",onClick:U=>ye(l),title:"删除"},{default:t(()=>[e(b,null,{default:t(()=>[e(A(X))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})):E("",!0)]),_:1},8,["data"]),y.value!=="view"?(N(),q("div",Pe,[e(u,{type:"primary",onClick:a[9]||(a[9]=l=>H())},{default:t(()=>[e(b,null,{default:t(()=>[e(A(Z))]),_:1}),a[23]||(a[23]=c("添加付款计划 "))]),_:1})])):E("",!0)])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["modelValue","title"]),e(G,{modelValue:k.value,"onUpdate:modelValue":a[17]||(a[17]=l=>k.value=l),title:F.value?"编辑付款计划":"添加付款计划",width:"40%"},{footer:t(()=>[D("span",Ne,[e(u,{onClick:a[16]||(a[16]=l=>k.value=!1)},{default:t(()=>a[26]||(a[26]=[c("取消")])),_:1}),e(u,{type:"primary",onClick:fe},{default:t(()=>a[27]||(a[27]=[c("确定")])),_:1})])]),default:t(()=>[e(C,{ref_key:"paymentPlanFormRef",ref:$,model:r,rules:ne,"label-width":"100px"},{default:t(()=>[e(s,{label:"付款阶段",prop:"phase"},{default:t(()=>[e(i,{modelValue:r.phase,"onUpdate:modelValue":a[12]||(a[12]=l=>r.phase=l),placeholder:"请输入付款阶段名称"},null,8,["modelValue"])]),_:1}),e(s,{label:"付款金额",prop:"amount"},{default:t(()=>[e(Y,{modelValue:r.amount,"onUpdate:modelValue":a[13]||(a[13]=l=>r.amount=l),min:0,precision:2,step:1e3,style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(s,{label:"计划日期",prop:"planDate"},{default:t(()=>[e(j,{modelValue:r.planDate,"onUpdate:modelValue":a[14]||(a[14]=l=>r.planDate=l),type:"date",placeholder:"请选择计划付款日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(s,{label:"付款条件",prop:"condition"},{default:t(()=>[e(i,{modelValue:r.condition,"onUpdate:modelValue":a[15]||(a[15]=l=>r.condition=l),type:"textarea",placeholder:"请输入付款条件"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},he=ve(ke,[["__scopeId","data-v-534fd493"]]);export{he as default};
