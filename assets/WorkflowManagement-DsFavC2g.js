import{_ as Ve,r as O,a as _,k as ke,c as U,o as i,d as e,b as z,w as t,e as r,B as Ce,F as h,i as B,g as p,D as k,m as j,K as xe,H as Se,x as Te,C as Ue,h as C,t as F,I as ze,L as De,M as he,j as N,J as Y,E as S}from"./index-BrrAfP23.js";const Be={class:"workflow-management-container"},$e={class:"operation-container"},Fe={class:"left-buttons"},Pe={class:"pagination-container"},Me={style:{"margin-top":"10px"}},Ee={class:"dialog-footer"},Oe={__name:"WorkflowManagement",setup(je){const R=[{value:"all",label:"全部"},{value:"enabled",label:"启用"},{value:"disabled",label:"停用"}],I=[{value:"all",label:"全部"},{value:"application",label:"申请单"},{value:"reimbursement",label:"报销单"}],u=O({name:"",status:"all",type:"all"}),W=_([]),P=_(!1),q=_([]),c=O({currentPage:1,pageSize:10,total:0}),g=_(!1),v=_(""),D=_(""),M=_(null),n=O({id:"",name:"",type:"application",status:"enabled",nodes:[],documents:[]}),A={name:[{required:!0,message:"请输入流程名称",trigger:"blur"}],type:[{required:!0,message:"请选择流程类型",trigger:"change"}]},Z=_([{value:"flow1-1",label:"一录一审（员工-部门主管）",type:"application"},{value:"flow1-2",label:"一录两审（员工-部门主管-部门总经理）",type:"application"},{value:"flow1-3",label:"一录三审（员工-项目经理-部门主管-部门总经理）",type:"application"},{value:"flow1-4",label:"一录四审（员工-项目经理-部门主管-部门总经理-行政人员）",type:"application"},{value:"flow2-1",label:"一录一审（员工-财务人员）",type:"reimbursement"},{value:"flow2-2",label:"一录两审（员工-部门主管-财务人员）",type:"reimbursement"},{value:"flow2-3",label:"一录三审（员工-部门主管-部门总经理-财务人员）",type:"reimbursement"},{value:"flow2-4",label:"一录四审（员工-项目经理-部门主管-部门总经理-财务人员）",type:"reimbursement"}]),ee=_([{value:"employee",label:"员工"},{value:"dept_manager",label:"部门主管"},{value:"finance_staff",label:"财务人员"},{value:"dept_director",label:"部门总经理"},{value:"finance_manager",label:"财务主管"},{value:"project_manager",label:"项目经理"},{value:"admin_staff",label:"行政人员"},{value:"system_admin",label:"商旅系统管理员"}]),L=_([]),T=_(null),E=_(null);ke(()=>{w(),le()});const w=()=>{P.value=!0,setTimeout(()=>{let l=[...[{id:"1",name:"出差申请单审批流程",type:"application",status:"enabled",createTime:"2023-05-15 10:30:00",nodes:[{id:1,name:"部门主管审批",role:"dept_manager"},{id:2,name:"部门总经理审批",role:"dept_director"}],documents:["出差申请单"]},{id:"2",name:"出差报销单审批流程",type:"reimbursement",status:"enabled",createTime:"2023-05-15 11:20:00",nodes:[{id:1,name:"部门主管审批",role:"dept_manager"},{id:2,name:"部门总经理审批",role:"dept_director"},{id:3,name:"财务人员审批",role:"finance_staff"}],documents:["出差报销单"]},{id:"3",name:"招待费报销审批流程",type:"reimbursement",status:"disabled",createTime:"2023-05-16 09:15:00",nodes:[{id:1,name:"部门主管审批",role:"dept_manager"},{id:2,name:"财务人员审批",role:"finance_staff"}],documents:["招待费报销单"]}]];u.name&&(l=l.filter(d=>d.name.includes(u.name))),u.status!=="all"&&(l=l.filter(d=>d.status===u.status)),u.type!=="all"&&(l=l.filter(d=>d.type===u.type)),c.total=l.length;const m=(c.currentPage-1)*c.pageSize,s=m+c.pageSize;W.value=l.slice(m,s),P.value=!1},500)},le=()=>{setTimeout(()=>{L.value=[{value:"1",label:"出差申请单",type:"application",status:"enabled"},{value:"2",label:"出差报销单",type:"reimbursement",status:"enabled"},{value:"3",label:"借款单",type:"application",status:"enabled"},{value:"4",label:"招待费报销单",type:"reimbursement",status:"enabled"},{value:"5",label:"费用报销单",type:"reimbursement",status:"enabled"},{value:"6",label:"合同付款单",type:"application",status:"disabled"}]},500)},H=()=>{c.currentPage=1,w()},ae=()=>{u.name="",u.status="all",u.type="all",H()},te=o=>{q.value=o},ne=o=>{c.currentPage=o,w()},oe=o=>{c.pageSize=o,c.currentPage=1,w()},ue=()=>{v.value="new",D.value="新增流程",J(),g.value=!0},se=()=>{v.value="import",D.value="导入流程模板",J(),g.value=!0},de=o=>{v.value="edit",D.value="编辑流程",M.value=o,Object.keys(n).forEach(l=>{l in o&&(n[l]=o[l])}),g.value=!0},ie=o=>{v.value="associate",D.value="关联单据",M.value=o,n.documents=o.documents||[],g.value=!0},J=()=>{n.id="",n.name="",n.type="application",n.status="enabled",n.nodes=[],n.documents=[],T.value&&T.value.resetFields()},re=async()=>{T.value&&await T.value.validate(o=>{o&&(v.value==="new"||v.value==="edit"?(S.success(v.value==="new"?"新增流程成功":"编辑流程成功"),g.value=!1,w()):v.value==="import"&&(S.success("导入流程模板成功"),g.value=!1,w()))})},pe=async()=>{E.value&&await E.value.validate(o=>{o&&(S.success("关联单据成功"),g.value=!1,w())})},me=()=>{if(q.value.length===0){S.warning("请至少选择一条记录");return}Y.confirm("确认删除选中的流程吗？删除后将无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{S.success("删除成功"),w()}).catch(()=>{})},fe=o=>{const l=o.status==="enabled"?"disabled":"enabled",m=l==="enabled"?"启用":"停用";Y.confirm(`确认${m}该流程吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.status=l,S.success(`${m}成功`),w()}).catch(()=>{})},ce=()=>{S.info("跳转到单据管理功能")},ve=o=>{const l=I.find(m=>m.value===o);return l?l.label:""},be=o=>{const l=R.find(m=>m.value===o);return l?l.label:""};return(o,l)=>{const m=r("el-input"),s=r("el-form-item"),d=r("el-option"),x=r("el-select"),V=r("el-icon"),b=r("el-button"),$=r("el-form"),K=r("el-card"),y=r("el-table-column"),G=r("el-tag"),_e=r("el-tooltip"),Q=r("el-table"),ye=r("el-pagination"),X=r("el-switch"),ge=r("el-dialog"),we=Ce("loading");return i(),U("div",Be,[e(K,{class:"search-card"},{default:t(()=>[e($,{inline:!0,model:u,class:"search-form"},{default:t(()=>[e(s,{label:"流程名称"},{default:t(()=>[e(m,{modelValue:u.name,"onUpdate:modelValue":l[0]||(l[0]=a=>u.name=a),placeholder:"请输入流程名称",clearable:""},null,8,["modelValue"])]),_:1}),e(s,{label:"流程类型"},{default:t(()=>[e(x,{modelValue:u.type,"onUpdate:modelValue":l[1]||(l[1]=a=>u.type=a),placeholder:"请选择流程类型",clearable:""},{default:t(()=>[(i(),U(h,null,B(I,a=>e(d,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"流程状态"},{default:t(()=>[e(x,{modelValue:u.status,"onUpdate:modelValue":l[2]||(l[2]=a=>u.status=a),placeholder:"请选择流程状态",clearable:""},{default:t(()=>[(i(),U(h,null,B(R,a=>e(d,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:t(()=>[e(b,{type:"primary",onClick:H},{default:t(()=>[e(V,null,{default:t(()=>[e(k(j))]),_:1}),l[17]||(l[17]=p(" 查询 "))]),_:1}),e(b,{onClick:ae},{default:t(()=>l[18]||(l[18]=[p(" 重置 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),z("div",$e,[z("div",Fe,[e(b,{type:"primary",onClick:ue},{default:t(()=>[e(V,null,{default:t(()=>[e(k(j))]),_:1}),l[19]||(l[19]=p(" 新增流程 "))]),_:1}),e(b,{type:"success",onClick:se},{default:t(()=>[e(V,null,{default:t(()=>[e(k(xe))]),_:1}),l[20]||(l[20]=p(" 导入模板 "))]),_:1}),e(b,{type:"danger",onClick:me},{default:t(()=>[e(V,null,{default:t(()=>[e(k(Se))]),_:1}),l[21]||(l[21]=p(" 批量删除 "))]),_:1}),e(b,{onClick:ce},{default:t(()=>[e(V,null,{default:t(()=>[e(k(Te))]),_:1}),l[22]||(l[22]=p(" 单据管理 "))]),_:1})])]),e(K,{class:"table-card"},{default:t(()=>[Ue((i(),C(Q,{data:W.value,style:{width:"100%"},onSelectionChange:te},{default:t(()=>[e(y,{type:"selection",width:"55"}),e(y,{prop:"id",label:"流程ID",width:"100"}),e(y,{prop:"name",label:"流程名称","min-width":"150","show-overflow-tooltip":""}),e(y,{prop:"type",label:"流程类型",width:"120"},{default:t(a=>[e(G,{type:a.row.type==="application"?"primary":"success",effect:"plain"},{default:t(()=>[p(F(ve(a.row.type)),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"status",label:"流程状态",width:"100"},{default:t(a=>[e(G,{type:a.row.status==="enabled"?"success":"info",effect:"dark"},{default:t(()=>[p(F(be(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"createTime",label:"创建时间",width:"180"}),e(y,{label:"关联单据",width:"150"},{default:t(a=>[e(_e,{effect:"dark",content:a.row.documents.join("、"),placement:"top",disabled:!a.row.documents||a.row.documents.length===0},{default:t(()=>[z("span",null,F(a.row.documents?a.row.documents.length:0)+"个单据",1)]),_:2},1032,["content","disabled"])]),_:1}),e(y,{label:"操作",width:"280",fixed:"right"},{default:t(a=>[e(b,{type:"primary",size:"small",onClick:f=>de(a.row)},{default:t(()=>[e(V,null,{default:t(()=>[e(k(ze))]),_:1}),l[23]||(l[23]=p(" 编辑 "))]),_:2},1032,["onClick"]),e(b,{type:"success",size:"small",onClick:f=>ie(a.row)},{default:t(()=>[e(V,null,{default:t(()=>[e(k(j))]),_:1}),l[24]||(l[24]=p(" 关联单据 "))]),_:2},1032,["onClick"]),e(b,{type:a.row.status==="enabled"?"warning":"success",size:"small",onClick:f=>fe(a.row)},{default:t(()=>[a.row.status==="enabled"?(i(),C(V,{key:0},{default:t(()=>[e(k(De))]),_:1})):(i(),C(V,{key:1},{default:t(()=>[e(k(he))]),_:1})),p(" "+F(a.row.status==="enabled"?"停用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])),[[we,P.value]]),z("div",Pe,[e(ye,{"current-page":c.currentPage,"onUpdate:currentPage":l[3]||(l[3]=a=>c.currentPage=a),"page-size":c.pageSize,"onUpdate:pageSize":l[4]||(l[4]=a=>c.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:c.total,onSizeChange:oe,onCurrentChange:ne},null,8,["current-page","page-size","total"])])]),_:1}),e(ge,{modelValue:g.value,"onUpdate:modelValue":l[16]||(l[16]=a=>g.value=a),title:D.value,width:"650px","destroy-on-close":""},{footer:t(()=>[z("span",Ee,[e(b,{onClick:l[14]||(l[14]=a=>g.value=!1)},{default:t(()=>l[27]||(l[27]=[p("取消")])),_:1}),e(b,{type:"primary",onClick:l[15]||(l[15]=a=>v.value==="associate"?pe():re())},{default:t(()=>l[28]||(l[28]=[p(" 确定 ")])),_:1})])]),default:t(()=>[v.value==="new"||v.value==="edit"?(i(),C($,{key:0,ref_key:"formRef",ref:T,model:n,rules:A,"label-width":"100px"},{default:t(()=>[e(s,{label:"流程名称",prop:"name"},{default:t(()=>[e(m,{modelValue:n.name,"onUpdate:modelValue":l[5]||(l[5]=a=>n.name=a),placeholder:"请输入流程名称"},null,8,["modelValue"])]),_:1}),e(s,{label:"流程类型",prop:"type"},{default:t(()=>[e(x,{modelValue:n.type,"onUpdate:modelValue":l[6]||(l[6]=a=>n.type=a),placeholder:"请选择流程类型"},{default:t(()=>[e(d,{label:"申请单",value:"application"}),e(d,{label:"报销单",value:"reimbursement"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"流程状态"},{default:t(()=>[e(X,{modelValue:n.status,"onUpdate:modelValue":l[7]||(l[7]=a=>n.status=a),"active-value":"enabled","inactive-value":"disabled","active-text":"启用","inactive-text":"停用"},null,8,["modelValue"])]),_:1}),e(s,{label:"审批节点"},{default:t(()=>[e(Q,{data:n.nodes,style:{width:"100%"}},{default:t(()=>[e(y,{label:"节点名称",prop:"name"},{default:t(a=>[e(m,{modelValue:a.row.name,"onUpdate:modelValue":f=>a.row.name=f,placeholder:"请输入节点名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(y,{label:"审批角色",prop:"role"},{default:t(a=>[e(x,{modelValue:a.row.role,"onUpdate:modelValue":f=>a.row.role=f,placeholder:"请选择审批角色"},{default:t(()=>[(i(!0),U(h,null,B(ee.value,f=>(i(),C(d,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(y,{label:"操作",width:"80"},{default:t(a=>[e(b,{type:"danger",size:"small",onClick:f=>n.nodes.splice(a.$index,1)},{default:t(()=>l[25]||(l[25]=[p(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),z("div",Me,[e(b,{type:"primary",onClick:l[8]||(l[8]=a=>n.nodes.push({id:n.nodes.length+1,name:"",role:""}))},{default:t(()=>l[26]||(l[26]=[p(" 添加节点 ")])),_:1})])]),_:1})]),_:1},8,["model"])):N("",!0),v.value==="import"?(i(),C($,{key:1,ref_key:"formRef",ref:T,model:n,rules:A,"label-width":"100px"},{default:t(()=>[e(s,{label:"流程名称",prop:"name"},{default:t(()=>[e(m,{modelValue:n.name,"onUpdate:modelValue":l[9]||(l[9]=a=>n.name=a),placeholder:"请输入流程名称"},null,8,["modelValue"])]),_:1}),e(s,{label:"流程类型",prop:"type"},{default:t(()=>[e(x,{modelValue:n.type,"onUpdate:modelValue":l[10]||(l[10]=a=>n.type=a),placeholder:"请选择流程类型"},{default:t(()=>[e(d,{label:"申请单",value:"application"}),e(d,{label:"报销单",value:"reimbursement"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"流程模板"},{default:t(()=>[e(x,{modelValue:n.template,"onUpdate:modelValue":l[11]||(l[11]=a=>n.template=a),placeholder:"请选择流程模板",style:{width:"100%"}},{default:t(()=>[(i(!0),U(h,null,B(Z.value.filter(a=>a.type===n.type),a=>(i(),C(d,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"流程状态"},{default:t(()=>[e(X,{modelValue:n.status,"onUpdate:modelValue":l[12]||(l[12]=a=>n.status=a),"active-value":"enabled","inactive-value":"disabled","active-text":"启用","inactive-text":"停用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):N("",!0),v.value==="associate"?(i(),C($,{key:2,ref_key:"associateFormRef",ref:E,model:n,"label-width":"100px"},{default:t(()=>[e(s,{label:"关联单据"},{default:t(()=>[e(x,{modelValue:n.documents,"onUpdate:modelValue":l[13]||(l[13]=a=>n.documents=a),multiple:"",placeholder:"请选择关联单据",style:{width:"100%"}},{default:t(()=>[(i(!0),U(h,null,B(L.value.filter(a=>{var f;return a.type===((f=M.value)==null?void 0:f.type)&&a.status==="enabled"}),a=>(i(),C(d,{key:a.value,label:a.label,value:a.label},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])):N("",!0)]),_:1},8,["modelValue","title"])])}}},Re=Ve(Oe,[["__scopeId","data-v-ea058fba"]]);export{Re as default};
