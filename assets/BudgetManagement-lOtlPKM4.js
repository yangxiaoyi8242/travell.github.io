import{_ as I,a as g,r as Y,k as $,c as V,o as c,d as e,w as a,e as o,B as j,C as q,h as x,g as m,t as A,b as R,j as T,E as U}from"./index-BrrAfP23.js";const G={class:"budget-management-container"},H={class:"card-header"},J={key:0,class:"edit-form"},K={class:"dialog-footer"},O={__name:"BudgetManagement",setup(Q){const i=g([{id:1,department:"销售部",yearlyBudget:5e5,usedAmount:32e4,remainingAmount:18e4,usageRate:64,lastUpdateTime:"2023-06-15 10:30:45"},{id:2,department:"市场部",yearlyBudget:3e5,usedAmount:21e4,remainingAmount:9e4,usageRate:70,lastUpdateTime:"2023-06-14 16:20:33"},{id:3,department:"研发部",yearlyBudget:8e5,usedAmount:45e4,remainingAmount:35e4,usageRate:56.25,lastUpdateTime:"2023-06-16 09:15:27"},{id:4,department:"财务部",yearlyBudget:15e4,usedAmount:8e4,remainingAmount:7e4,usageRate:53.33,lastUpdateTime:"2023-06-13 14:45:12"},{id:5,department:"人力资源部",yearlyBudget:2e5,usedAmount:12e4,remainingAmount:8e4,usageRate:60,lastUpdateTime:"2023-06-12 11:30:45"},{id:6,department:"行政部",yearlyBudget:25e4,usedAmount:18e4,remainingAmount:7e4,usageRate:72,lastUpdateTime:"2023-06-11 15:20:33"}]),y=g(!1),_=g(null),p=g(!1),r=Y({id:"",department:"",yearlyBudget:0}),C={yearlyBudget:[{required:!0,message:"请输入年度预算金额",trigger:"blur"},{type:"number",message:"金额必须为数字",trigger:"blur",transform:n=>Number(n)},{type:"number",min:0,message:"金额不能小于0",trigger:"blur",transform:n=>Number(n)}]},f=g(null),N=n=>{_.value=n,p.value=!0,r.id=n.id,r.department=n.department,r.yearlyBudget=n.yearlyBudget},h=async()=>{f.value&&await f.value.validate((n,t)=>{if(n){const v=U({message:"正在更新预算...",type:"info",duration:0});setTimeout(()=>{v.close();const d=i.value.findIndex(u=>u.id===r.id);if(d!==-1){const u=i.value[d].usedAmount,s=r.yearlyBudget,B=s-u,w=(u/s*100).toFixed(2);i.value[d].yearlyBudget=s,i.value[d].remainingAmount=B,i.value[d].usageRate=parseFloat(w),i.value[d].lastUpdateTime=new Date().toLocaleString()}U({message:"预算更新成功！",type:"success"}),p.value=!1},1e3)}})},D=n=>n<50?"success":n<80?"warning":"danger",b=n=>n.toLocaleString("zh-CN",{style:"currency",currency:"CNY"}).replace("CN¥","¥");return $(()=>{y.value=!0,setTimeout(()=>{y.value=!1},800)}),(n,t)=>{const v=o("Plus"),d=o("el-icon"),u=o("el-button"),s=o("el-table-column"),B=o("el-progress"),w=o("el-table"),F=o("el-card"),E=o("el-input"),k=o("el-form-item"),M=o("el-input-number"),L=o("el-alert"),P=o("el-form"),S=o("el-dialog"),z=j("loading");return c(),V("div",G,[e(F,{class:"budget-card"},{header:a(()=>[R("div",H,[t[5]||(t[5]=R("h2",null,"预算管理",-1)),e(u,{type:"primary",size:"small"},{default:a(()=>[e(d,null,{default:a(()=>[e(v)]),_:1}),t[4]||(t[4]=m("新增部门预算 "))]),_:1})])]),default:a(()=>[q((c(),x(w,{data:i.value,style:{width:"100%"},border:"","row-key":"id"},{default:a(()=>[e(s,{prop:"department",label:"部门",width:"120"}),e(s,{prop:"yearlyBudget",label:"年度预算",width:"150"},{default:a(l=>[m(A(b(l.row.yearlyBudget)),1)]),_:1}),e(s,{prop:"usedAmount",label:"已使用",width:"150"},{default:a(l=>[m(A(b(l.row.usedAmount)),1)]),_:1}),e(s,{prop:"remainingAmount",label:"剩余预算",width:"150"},{default:a(l=>[m(A(b(l.row.remainingAmount)),1)]),_:1}),e(s,{prop:"usageRate",label:"使用率","min-width":"200"},{default:a(l=>[e(B,{percentage:l.row.usageRate,type:"line","stroke-width":15,status:D(l.row.usageRate)},null,8,["percentage","status"])]),_:1}),e(s,{prop:"lastUpdateTime",label:"最后更新时间",width:"180"}),e(s,{label:"操作",width:"120",fixed:"right"},{default:a(l=>[e(u,{link:"",type:"primary",onClick:W=>N(l.row)},{default:a(()=>t[6]||(t[6]=[m(" 编辑 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[z,y.value]])]),_:1}),e(S,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=l=>p.value=l),title:"编辑部门预算",width:"500px","destroy-on-close":""},{footer:a(()=>[R("span",K,[e(u,{onClick:t[2]||(t[2]=l=>p.value=!1)},{default:a(()=>t[7]||(t[7]=[m("取消")])),_:1}),e(u,{type:"primary",onClick:h},{default:a(()=>t[8]||(t[8]=[m("保存")])),_:1})])]),default:a(()=>[_.value?(c(),V("div",J,[e(P,{ref_key:"editFormRef",ref:f,model:r,rules:C,"label-width":"100px"},{default:a(()=>[e(k,{label:"部门"},{default:a(()=>[e(E,{modelValue:r.department,"onUpdate:modelValue":t[0]||(t[0]=l=>r.department=l),disabled:""},null,8,["modelValue"])]),_:1}),e(k,{label:"年度预算",prop:"yearlyBudget"},{default:a(()=>[e(M,{modelValue:r.yearlyBudget,"onUpdate:modelValue":t[1]||(t[1]=l=>r.yearlyBudget=l),precision:2,step:1e4,min:0,style:{width:"100%"},placeholder:"请输入年度预算金额"},null,8,["modelValue"])]),_:1}),_.value.usedAmount>r.yearlyBudget?(c(),x(L,{key:0,title:"警告：设置的预算金额小于已使用金额！",type:"error",closable:!1,style:{"margin-top":"15px"}})):T("",!0)]),_:1},8,["model"])])):T("",!0)]),_:1},8,["modelValue"])])}}},Z=I(O,[["__scopeId","data-v-fe672d83"]]);export{Z as default};
